<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Deployment Guide &#8212; exodus-gw  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=32913b9a" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=fd3f3429" />
    <script src="_static/documentation_options.js?v=5929fcd5"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Development Guide" href="development.html" />
    <link rel="prev" title="API Reference" href="api.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="deployment-guide">
<span id="deploy-guide"></span><h1>Deployment Guide<a class="headerlink" href="#deployment-guide" title="Link to this heading">¶</a></h1>
<section id="target-platform">
<h2>Target platform<a class="headerlink" href="#target-platform" title="Link to this heading">¶</a></h2>
<p>exodus-gw is an ASGI application which may be deployed using any ASGI-compliant
web server. The development team’s recommended setup is summarized as:</p>
<ul>
<li><p>Use OpenShift &gt;= 4.x to deploy the service.</p></li>
<li><p>Use the exodus-gw images at <a class="reference external" href="https://quay.io/repository/exodus/exodus-gw">https://quay.io/repository/exodus/exodus-gw</a> to run
the service. These images run the service using gunicorn &amp; uvicorn on RHEL8.</p>
<p>In general, the
<a class="reference external" href="https://www.uvicorn.org/deployment/">uvicorn deployment advice</a>
applies.</p>
</li>
<li><p>Deploy the service’s primary container behind a reverse-proxy implementing
authentication according to your organization’s needs (see next section).</p></li>
</ul>
</section>
<section id="authentication-authorization">
<h2>Authentication &amp; Authorization<a class="headerlink" href="#authentication-authorization" title="Link to this heading">¶</a></h2>
<p>The exodus-gw service does not implement any authentication mechanism. It is instead
designed to integrate with a reverse-proxy implementing any desired mechanism.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If exodus-gw is deployed without an authenticating reverse-proxy, the service must
be considered completely unsecured - all users will be able to perform all operations.</p>
</div>
<p>This reverse-proxy must add an <code class="docutils literal notranslate"><span class="pre">X-RhApiPlatform-CallContext</span></code> header onto all incoming
requests. This header must contain a base64-encoded form of the following JSON object:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;client&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;roles&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;someRole&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;anotherRole&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;authenticated&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;serviceAccountId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;clientappname&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;user&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;roles&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;viewer&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;authenticated&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;internalUsername&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;someuser&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">roles</span></code> and <code class="docutils literal notranslate"><span class="pre">authenticated</span></code> fields influence whether an exodus-gw request will be
permitted - the necessary roles are documented on relevant exodus-gw API endpoints.
Other fields are unused or used only for logging.</p>
<p>The separate <code class="docutils literal notranslate"><span class="pre">client</span></code> and <code class="docutils literal notranslate"><span class="pre">user</span></code> fields can be used to separate service accounts
(machine users) from human users, but this does not affect exodus-gw.</p>
<p>Within Red Hat, a container known as “platform-sidecar” is used as the reverse proxy - consult
internal documentation for information on this component. In other contexts, any reverse
proxy may be used as long as it produces headers according to the scheme documented above.</p>
</section>
<section id="database-migrations">
<h2>Database Migrations<a class="headerlink" href="#database-migrations" title="Link to this heading">¶</a></h2>
<p>The exodus-gw service uses a postgres database.</p>
<p>On startup, the service will run database migrations to ensure the DB implements the
required schema.</p>
<p>It is a goal that migrations can be performed online with minimal disruption to the
service, even with old and new versions of the service running simultaneously
(for example, during an OpenShift rolling deployment).</p>
<p>Downgrading to an earlier version of the schema is not directly supported by the
service. However, as exodus-gw is designed not to store any permanent state, dropping
and recreating the exodus-gw database is a viable option if needed.</p>
</section>
<section id="settings">
<h2>Settings<a class="headerlink" href="#settings" title="Link to this heading">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="exodus_gw.settings.Settings">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">exodus_gw.settings.</span></span><span class="sig-name descname"><span class="pre">Settings</span></span><a class="reference internal" href="_modules/exodus_gw/settings.html#Settings"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#exodus_gw.settings.Settings" title="Link to this definition">¶</a></dt>
<dd><p>exodus-gw may be configured by the following settings.</p>
<p>Each settings value may be overridden using an environment variable of the
same name, prefixed with <code class="docutils literal notranslate"><span class="pre">EXODUS_GW_</span></code> (example: <code class="docutils literal notranslate"><span class="pre">EXODUS_GW_CALL_CONTEXT_HEADER</span></code>).</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="exodus_gw.settings.Settings.call_context_header">
<span class="sig-name descname"><span class="pre">call_context_header</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><span class="pre">str</span></a></em><a class="headerlink" href="#exodus_gw.settings.Settings.call_context_header" title="Link to this definition">¶</a></dt>
<dd><p>Name of the header from which to extract call context (for authentication
and authorization).</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="exodus_gw.settings.Settings.upload_meta_fields">
<span class="sig-name descname"><span class="pre">upload_meta_fields</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.12)"><span class="pre">dict</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><span class="pre">str</span></a><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#exodus_gw.settings.Settings.upload_meta_fields" title="Link to this definition">¶</a></dt>
<dd><p>Permitted metadata field names for s3 uploads and their regex
for validation. E.g., “exodus-migration-md5”: “^[0-9a-f]{32}$”</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="exodus_gw.settings.Settings.publish_paths">
<span class="sig-name descname"><span class="pre">publish_paths</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.12)"><span class="pre">dict</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.12)"><span class="pre">dict</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.12)"><span class="pre">list</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><span class="pre">str</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#exodus_gw.settings.Settings.publish_paths" title="Link to this definition">¶</a></dt>
<dd><p>A set of user or service accounts which are only authorized to publish to a
particular set of path(s) in a given CDN environment and the regex(es) describing
the paths to which the user or service account is authorized to publish. The user or
service account will be prevented from publishing to any paths that do not match the
defined regular expression(s).
E.g., ‘{“pre”: {“fake-user”:
[“^(/content)?/origin/files/sha256/[0-f]{2}/[0-f]{64}/[^/]{1,300}$”]}}’</p>
<p>Any user or service account not included in this configuration is considered to have
unrestricted publish access (i.e., can publish to any path).</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="exodus_gw.settings.Settings.log_config">
<span class="sig-name descname"><span class="pre">log_config</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.12)"><span class="pre">dict</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Any" title="(in Python v3.12)"><span class="pre">Any</span></a><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#exodus_gw.settings.Settings.log_config" title="Link to this definition">¶</a></dt>
<dd><p>Logging configuration in dictConfig schema.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="exodus_gw.settings.Settings.ini_path">
<span class="sig-name descname"><span class="pre">ini_path</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><span class="pre">str</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.12)"><span class="pre">None</span></a></em><a class="headerlink" href="#exodus_gw.settings.Settings.ini_path" title="Link to this definition">¶</a></dt>
<dd><p>Path to an exodus-gw.ini config file with additional settings.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="exodus_gw.settings.Settings.db_service_user">
<span class="sig-name descname"><span class="pre">db_service_user</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><span class="pre">str</span></a></em><a class="headerlink" href="#exodus_gw.settings.Settings.db_service_user" title="Link to this definition">¶</a></dt>
<dd><p>db service user name</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="exodus_gw.settings.Settings.db_service_pass">
<span class="sig-name descname"><span class="pre">db_service_pass</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><span class="pre">str</span></a></em><a class="headerlink" href="#exodus_gw.settings.Settings.db_service_pass" title="Link to this definition">¶</a></dt>
<dd><p>db service user password</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="exodus_gw.settings.Settings.db_service_host">
<span class="sig-name descname"><span class="pre">db_service_host</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><span class="pre">str</span></a></em><a class="headerlink" href="#exodus_gw.settings.Settings.db_service_host" title="Link to this definition">¶</a></dt>
<dd><p>db service host</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="exodus_gw.settings.Settings.db_service_port">
<span class="sig-name descname"><span class="pre">db_service_port</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><span class="pre">str</span></a></em><a class="headerlink" href="#exodus_gw.settings.Settings.db_service_port" title="Link to this definition">¶</a></dt>
<dd><p>db service port</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="exodus_gw.settings.Settings.db_url">
<span class="sig-name descname"><span class="pre">db_url</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><span class="pre">str</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.12)"><span class="pre">None</span></a></em><a class="headerlink" href="#exodus_gw.settings.Settings.db_url" title="Link to this definition">¶</a></dt>
<dd><p>Connection string for database. If set, overrides the <code class="docutils literal notranslate"><span class="pre">db_service_*</span></code> settings.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="exodus_gw.settings.Settings.db_reset">
<span class="sig-name descname"><span class="pre">db_reset</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)"><span class="pre">bool</span></a></em><a class="headerlink" href="#exodus_gw.settings.Settings.db_reset" title="Link to this definition">¶</a></dt>
<dd><p>If set to True, drop all DB tables during startup.</p>
<p>This setting is intended for use during development.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="exodus_gw.settings.Settings.db_migration_mode">
<span class="sig-name descname"><span class="pre">db_migration_mode</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">MigrationMode</span></em><a class="headerlink" href="#exodus_gw.settings.Settings.db_migration_mode" title="Link to this definition">¶</a></dt>
<dd><p>Adjusts the DB migration behavior when the exodus-gw service starts.</p>
<p>Valid values are:</p>
<blockquote>
<div><dl>
<dt>upgrade (default)</dt><dd><p>Migrate the DB to <code class="docutils literal notranslate"><span class="pre">db_migration_revision</span></code> (default latest) when
the service starts up.</p>
<p>This is the default setting and should be left enabled for typical
production use.</p>
</dd>
<dt>model</dt><dd><p>Don’t use migrations. Instead, attempt to initialize the database
from the current version of the internal sqlalchemy model.</p>
<p>This is intended for use during development while prototyping
schema changes.</p>
</dd>
<dt>none</dt><dd><p>Don’t perform any DB initialization at all.</p>
</dd>
</dl>
</div></blockquote>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="exodus_gw.settings.Settings.db_migration_revision">
<span class="sig-name descname"><span class="pre">db_migration_revision</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><span class="pre">str</span></a></em><a class="headerlink" href="#exodus_gw.settings.Settings.db_migration_revision" title="Link to this definition">¶</a></dt>
<dd><p>If <code class="docutils literal notranslate"><span class="pre">db_migration_mode</span></code> is <code class="docutils literal notranslate"><span class="pre">upgrade</span></code>, this setting can be used to override
the target revision when migrating the DB.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="exodus_gw.settings.Settings.db_session_max_tries">
<span class="sig-name descname"><span class="pre">db_session_max_tries</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><span class="pre">int</span></a></em><a class="headerlink" href="#exodus_gw.settings.Settings.db_session_max_tries" title="Link to this definition">¶</a></dt>
<dd><p>The maximum number of attempts to recreate a DB session within a request.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="exodus_gw.settings.Settings.item_yield_size">
<span class="sig-name descname"><span class="pre">item_yield_size</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><span class="pre">int</span></a></em><a class="headerlink" href="#exodus_gw.settings.Settings.item_yield_size" title="Link to this definition">¶</a></dt>
<dd><p>Number of publish items to load from the service DB at one time.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="exodus_gw.settings.Settings.write_batch_size">
<span class="sig-name descname"><span class="pre">write_batch_size</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><span class="pre">int</span></a></em><a class="headerlink" href="#exodus_gw.settings.Settings.write_batch_size" title="Link to this definition">¶</a></dt>
<dd><p>Maximum number of items to write to the DynamoDB table at one time.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="exodus_gw.settings.Settings.write_max_tries">
<span class="sig-name descname"><span class="pre">write_max_tries</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><span class="pre">int</span></a></em><a class="headerlink" href="#exodus_gw.settings.Settings.write_max_tries" title="Link to this definition">¶</a></dt>
<dd><p>Maximum write attempts to the DynamoDB table.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="exodus_gw.settings.Settings.write_max_workers">
<span class="sig-name descname"><span class="pre">write_max_workers</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><span class="pre">int</span></a></em><a class="headerlink" href="#exodus_gw.settings.Settings.write_max_workers" title="Link to this definition">¶</a></dt>
<dd><p>Maximum number of worker threads used in the DynamoDB batch writes.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="exodus_gw.settings.Settings.write_queue_size">
<span class="sig-name descname"><span class="pre">write_queue_size</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><span class="pre">int</span></a></em><a class="headerlink" href="#exodus_gw.settings.Settings.write_queue_size" title="Link to this definition">¶</a></dt>
<dd><p>Maximum number of items the queue can hold at one time.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="exodus_gw.settings.Settings.write_queue_timeout">
<span class="sig-name descname"><span class="pre">write_queue_timeout</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><span class="pre">int</span></a></em><a class="headerlink" href="#exodus_gw.settings.Settings.write_queue_timeout" title="Link to this definition">¶</a></dt>
<dd><p>Maximum amount of time (in seconds) to wait for queue items.
Defaults to 10 minutes.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="exodus_gw.settings.Settings.publish_timeout">
<span class="sig-name descname"><span class="pre">publish_timeout</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><span class="pre">int</span></a></em><a class="headerlink" href="#exodus_gw.settings.Settings.publish_timeout" title="Link to this definition">¶</a></dt>
<dd><p>Maximum amount of time (in hours) between updates to a pending publish before
it will be considered abandoned. Defaults to one day.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="exodus_gw.settings.Settings.history_timeout">
<span class="sig-name descname"><span class="pre">history_timeout</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><span class="pre">int</span></a></em><a class="headerlink" href="#exodus_gw.settings.Settings.history_timeout" title="Link to this definition">¶</a></dt>
<dd><p>Maximum amount of time (in hours) to retain historical data for publishes and
tasks. Publishes and tasks in a terminal state will be erased after this time has
passed. Defaults to two weeks.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="exodus_gw.settings.Settings.path_history_timeout">
<span class="sig-name descname"><span class="pre">path_history_timeout</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><span class="pre">int</span></a></em><a class="headerlink" href="#exodus_gw.settings.Settings.path_history_timeout" title="Link to this definition">¶</a></dt>
<dd><p>Maximum amount of time (in days) to retain data on published paths for
the purpose of cache flushing.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="exodus_gw.settings.Settings.task_deadline">
<span class="sig-name descname"><span class="pre">task_deadline</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><span class="pre">int</span></a></em><a class="headerlink" href="#exodus_gw.settings.Settings.task_deadline" title="Link to this definition">¶</a></dt>
<dd><p>Maximum amount of time (in hours) a task should remain viable. Defaults to two
hours.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="exodus_gw.settings.Settings.actor_time_limit">
<span class="sig-name descname"><span class="pre">actor_time_limit</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><span class="pre">int</span></a></em><a class="headerlink" href="#exodus_gw.settings.Settings.actor_time_limit" title="Link to this definition">¶</a></dt>
<dd><p>Maximum amount of time (in milliseconds) actors may run. Defaults to 30
minutes.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="exodus_gw.settings.Settings.actor_max_backoff">
<span class="sig-name descname"><span class="pre">actor_max_backoff</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><span class="pre">int</span></a></em><a class="headerlink" href="#exodus_gw.settings.Settings.actor_max_backoff" title="Link to this definition">¶</a></dt>
<dd><p>Maximum amount of time (in milliseconds) actors may use while backing
off retries. Defaults to five (5) minutes.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="exodus_gw.settings.Settings.entry_point_files">
<span class="sig-name descname"><span class="pre">entry_point_files</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.12)"><span class="pre">list</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><span class="pre">str</span></a><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#exodus_gw.settings.Settings.entry_point_files" title="Link to this definition">¶</a></dt>
<dd><p>List of file names that should be saved for last when publishing.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="exodus_gw.settings.Settings.autoindex_filename">
<span class="sig-name descname"><span class="pre">autoindex_filename</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><span class="pre">str</span></a></em><a class="headerlink" href="#exodus_gw.settings.Settings.autoindex_filename" title="Link to this definition">¶</a></dt>
<dd><p>Filename for indexes automatically generated during publish.</p>
<p>Can be set to an empty string to disable generation of indexes.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="exodus_gw.settings.Settings.autoindex_partial_excludes">
<span class="sig-name descname"><span class="pre">autoindex_partial_excludes</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.12)"><span class="pre">list</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><span class="pre">str</span></a><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#exodus_gw.settings.Settings.autoindex_partial_excludes" title="Link to this definition">¶</a></dt>
<dd><p>Background processing of autoindexes will be disabled for paths matching
any of these values.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="exodus_gw.settings.Settings.config_cache_ttl">
<span class="sig-name descname"><span class="pre">config_cache_ttl</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><span class="pre">int</span></a></em><a class="headerlink" href="#exodus_gw.settings.Settings.config_cache_ttl" title="Link to this definition">¶</a></dt>
<dd><p>Time (in minutes) config is expected to live in components that consume it.</p>
<p>Determines the delay for deployment task completion to allow for
existing caches to expire and the newly deployed config to take effect.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="exodus_gw.settings.Settings.worker_health_filepath">
<span class="sig-name descname"><span class="pre">worker_health_filepath</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><span class="pre">str</span></a></em><a class="headerlink" href="#exodus_gw.settings.Settings.worker_health_filepath" title="Link to this definition">¶</a></dt>
<dd><p>The path to a file used to verify healthiness of a worker. Intended to be used by OCP</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="exodus_gw.settings.Settings.worker_keepalive_timeout">
<span class="sig-name descname"><span class="pre">worker_keepalive_timeout</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><span class="pre">int</span></a></em><a class="headerlink" href="#exodus_gw.settings.Settings.worker_keepalive_timeout" title="Link to this definition">¶</a></dt>
<dd><p>Background worker keepalive timeout, in seconds. If a worker fails to update its
status within this time period, it is assumed dead.</p>
<p>This setting affects how quickly the system can recover from issues such as a worker
process being killed unexpectedly.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="exodus_gw.settings.Settings.worker_keepalive_interval">
<span class="sig-name descname"><span class="pre">worker_keepalive_interval</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><span class="pre">int</span></a></em><a class="headerlink" href="#exodus_gw.settings.Settings.worker_keepalive_interval" title="Link to this definition">¶</a></dt>
<dd><p>How often, in seconds, should background workers update their status.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="exodus_gw.settings.Settings.cron_cleanup">
<span class="sig-name descname"><span class="pre">cron_cleanup</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)"><span class="pre">str</span></a></em><a class="headerlink" href="#exodus_gw.settings.Settings.cron_cleanup" title="Link to this definition">¶</a></dt>
<dd><p>cron-style schedule for cleanup task.</p>
<p>exodus-gw will run a cleanup task approximately according to this schedule, removing old
data from the system.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="exodus_gw.settings.Settings.scheduler_interval">
<span class="sig-name descname"><span class="pre">scheduler_interval</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><span class="pre">int</span></a></em><a class="headerlink" href="#exodus_gw.settings.Settings.scheduler_interval" title="Link to this definition">¶</a></dt>
<dd><p>How often, in minutes, exodus-gw should check if a scheduled task is ready to run.</p>
<p>Note that the cron rules applied to each scheduled task are only as accurate as this
interval allows, i.e. each rule may be triggered up to <code class="docutils literal notranslate"><span class="pre">scheduler_interval</span></code> minutes late.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="exodus_gw.settings.Settings.scheduler_delay">
<span class="sig-name descname"><span class="pre">scheduler_delay</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><span class="pre">int</span></a></em><a class="headerlink" href="#exodus_gw.settings.Settings.scheduler_delay" title="Link to this definition">¶</a></dt>
<dd><p>Delay, in minutes, after exodus-gw workers start up before any scheduled tasks
should run.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="exodus_gw.settings.Settings.cdn_flush_on_commit">
<span class="sig-name descname"><span class="pre">cdn_flush_on_commit</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)"><span class="pre">bool</span></a></em><a class="headerlink" href="#exodus_gw.settings.Settings.cdn_flush_on_commit" title="Link to this definition">¶</a></dt>
<dd><p>Whether ‘commit’ tasks should automatically flush CDN cache for
affected URLs.</p>
<p>Only takes effect for environments where cache flush credentials/settings
have been configured.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="exodus_gw.settings.Settings.cdn_cookie_ttl">
<span class="sig-name descname"><span class="pre">cdn_cookie_ttl</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><span class="pre">int</span></a></em><a class="headerlink" href="#exodus_gw.settings.Settings.cdn_cookie_ttl" title="Link to this definition">¶</a></dt>
<dd><p>Time (in seconds) cookies generated by <code class="docutils literal notranslate"><span class="pre">cdn-redirect</span></code> remain valid.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="exodus_gw.settings.Settings.cdn_signature_timeout">
<span class="sig-name descname"><span class="pre">cdn_signature_timeout</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><span class="pre">int</span></a></em><a class="headerlink" href="#exodus_gw.settings.Settings.cdn_signature_timeout" title="Link to this definition">¶</a></dt>
<dd><p>Time (in seconds) signed URLs remain valid.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="exodus_gw.settings.Settings.cdn_max_expire_days">
<span class="sig-name descname"><span class="pre">cdn_max_expire_days</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><span class="pre">int</span></a></em><a class="headerlink" href="#exodus_gw.settings.Settings.cdn_max_expire_days" title="Link to this definition">¶</a></dt>
<dd><p>Maximum permitted value for <code class="docutils literal notranslate"><span class="pre">expire_days</span></code> option on
<code class="docutils literal notranslate"><span class="pre">cdn-access</span></code> endpoint.</p>
<p>Clients obtaining signed cookies for CDN using <code class="docutils literal notranslate"><span class="pre">cdn-access</span></code> will be
forced to renew their cookies at least this frequently.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="exodus_gw.settings.Settings.s3_pool_size">
<span class="sig-name descname"><span class="pre">s3_pool_size</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><span class="pre">int</span></a></em><a class="headerlink" href="#exodus_gw.settings.Settings.s3_pool_size" title="Link to this definition">¶</a></dt>
<dd><p>Number of S3 clients to cache</p>
</dd></dl>

</dd></dl>

<p>To enable per-environment configuration of exodus-gw, exodus-gw.ini is available to point the
application at specific AWS resources and declare the AWS profile to use when interacting with
those resources. Each environment must appear in its own section with the prefix “env.”.</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[env.prod]</span>
<span class="na">aws_profile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">production</span>
<span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">cdn-prod-s3</span>
<span class="na">table</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">cdn-prod-db</span>
</pre></div>
</div>
<p>Logger levels may also be configured via exodus-gw.ini. Under a section named “loglevels”,
users may specify a logger name and the level at which to set said logger.</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[loglevels]</span>
<span class="na">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">NOTSET</span>
<span class="na">exodus-gw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">INFO</span>
<span class="na">s3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">DEBUG</span>
<span class="na">...</span>
</pre></div>
</div>
<section id="cdn-cache-flush">
<h3>CDN cache flush<a class="headerlink" href="#cdn-cache-flush" title="Link to this heading">¶</a></h3>
<p>exodus-gw supports flushing the cache of an Akamai CDN edge via
the <a class="reference external" href="https://techdocs.akamai.com/purge-cache/reference/api">Fast Purge API</a>.</p>
<p>This feature is optional. If configuration is not provided, related APIs in
exodus-gw will continue to function but will skip cache flush operations.</p>
<p>Enabling the feature requires the deployment of two sets of configuration.</p>
<p>Firstly, in the <code class="docutils literal notranslate"><span class="pre">exodus-gw.ini</span></code> section for the relevant environment,
set <code class="docutils literal notranslate"><span class="pre">cache_flush_urls</span></code> to enable cache flush by URL and/or
<code class="docutils literal notranslate"><span class="pre">cache_flush_arl_templates</span></code> to enable cache flushing by ARL. Both options
can be used together as needed.</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[env.live]</span>
<span class="c1"># Root URL(s) of CDN properties for which to flush cache.</span>
<span class="c1"># Several can be provided.</span>
<span class="na">cache_flush_urls</span><span class="w"> </span><span class="o">=</span>
<span class="w">  </span><span class="na">https</span><span class="o">:</span><span class="s">//cdn1.example.com</span>
<span class="w">  </span><span class="na">https</span><span class="o">:</span><span class="s">//cdn2.example.com</span>

<span class="c1"># Templates of ARL(s) for which to flush cache.</span>
<span class="c1"># Templates can use placeholders:</span>
<span class="c1"># - path: path of a file under CDN root</span>
<span class="c1"># - ttl (optional): a TTL value will be substituted</span>
<span class="na">cache_flush_arl_templates</span><span class="w"> </span><span class="o">=</span>
<span class="w">  </span><span class="na">S/</span><span class="o">=</span><span class="s">/123/22334455/{ttl}/cdn1.example.com/{path}</span>
<span class="w">  </span><span class="na">S/</span><span class="o">=</span><span class="s">/123/22334455/{ttl}/cdn2.example.com/{path}</span>
</pre></div>
</div>
<p>Secondly, use environment variables to deploy credentials for the
Fast Purge API, according to the below table. The fields here correspond
to those used by the <a class="reference external" href="https://techdocs.akamai.com/developer/docs/set-up-authentication-credentials">.edgerc file</a>
as found in Akamai’s documentation.</p>
<p>Note that “&lt;env&gt;” should be replaced with the specific corresponding
environment name, e.g. <code class="docutils literal notranslate"><span class="pre">EXODUS_GW_FASTPURGE_HOST_LIVE</span></code> for a <code class="docutils literal notranslate"><span class="pre">live</span></code>
environment.</p>
<table class="docutils align-default" id="id1">
<caption><span class="caption-text">Fast Purge credentials</span><a class="headerlink" href="#id1" title="Link to this table">¶</a></caption>
<tbody>
<tr class="row-odd"><td><p>Variable</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">.edgerc</span></code> field</p></td>
<td><p>Example</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">EXODUS_GW_FASTPURGE_CLIENT_SECRET_&lt;env&gt;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">client_secret</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">abcdEcSnaAt123FNkBxy456z25qx9Yp5CPUxlEfQeTDkfh4QA=I</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">EXODUS_GW_FASTPURGE_HOST_&lt;env&gt;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">host</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">akab-lmn789n2k53w7qrs10cxy-nfkxaa4lfk3kd6ym.luna.akamaiapis.net</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">EXODUS_GW_FASTPURGE_ACCESS_TOKEN_&lt;env&gt;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">access_token</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">akab-zyx987xa6osbli4k-e7jf5ikib5jknes3</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">EXODUS_GW_FASTPURGE_CLIENT_TOKEN_&lt;env&gt;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">client_token</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">akab-nomoflavjuc4422-fa2xznerxrm3teg7</span></code></p></td>
</tr>
</tbody>
</table>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">exodus-gw</a></h1>



<p class="blurb">Publishing microservice for Red Hat's Content Delivery Network</p>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="api.html">API Reference</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Deployment Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#target-platform">Target platform</a></li>
<li class="toctree-l2"><a class="reference internal" href="#authentication-authorization">Authentication &amp; Authorization</a></li>
<li class="toctree-l2"><a class="reference internal" href="#database-migrations">Database Migrations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#settings">Settings</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="development.html">Development Guide</a></li>
</ul>


<hr />
<ul>
    
    <li class="toctree-l1"><a href="https://github.com/release-engineering/exodus-gw">Source</a></li>
    
    <li class="toctree-l1"><a href="genindex.html">Index</a></li>
    
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="api.html" title="previous chapter">API Reference</a></li>
      <li>Next: <a href="development.html" title="next chapter">Development Guide</a></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2020, Red Hat.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.3.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="_sources/deployment.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/release-engineering/exodus-gw" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://github.blog/wp-content/uploads/2008/12/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
  </body>
</html>